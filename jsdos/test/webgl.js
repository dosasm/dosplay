"use strict";exports.__esModule=!0,exports.webGl=void 0;var vsSource="\nattribute vec4 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = aVertexPosition;\n  vTextureCoord = aTextureCoord;\n}\n",fsSource="\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\n\nvoid main(void) {\n  highp vec4 color = texture2D(uSampler, vTextureCoord);\n  gl_FragColor = vec4(color.r, color.g, color.b, 1.0);\n}\n";function webGl(e,r,t){var a=e.canvas,n=a.getContext("webgl");if(null===n)throw new Error("Unable to create webgl context on given canvas");var o=initShaderProgram(n,vsSource,fsSource),i=n.getAttribLocation(o,"aVertexPosition"),u=n.getAttribLocation(o,"aTextureCoord"),l=n.getUniformLocation(o,"uSampler");initBuffers(n,i,u);var T=n.createTexture();n.bindTexture(n.TEXTURE_2D,T),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);var E=new Uint8Array([0,0,0]);n.texImage2D(n.TEXTURE_2D,0,n.RGB,1,1,0,n.RGB,n.UNSIGNED_BYTE,E),n.useProgram(o),n.activeTexture(n.TEXTURE0),n.uniform1i(l,0);var v=e.width,c=e.height,d=0,R=0,A=function(){var e=d/R,r=v,t=v/e;t>c&&(t=c,r=c*e),a.style.position="relative",a.style.top=(c-t)/2+"px",a.style.left=(v-r)/2+"px",a.style.width=r+"px",a.style.height=t+"px"},h=function(e,r){v=e,c=r,A()};e.addOnResize(h);var g=function(e,r){d=e,R=r,a.width=d,a.height=R,n.viewport(0,0,d,R),A()};r.events().onFrameSize(g),g(r.width(),r.height());var f=null,s=null,_=0;t.begin(),r.events().onFrame((function(e,r){t.end(),t.begin(),s=null!=e?e:r,_=null!=e?n.RGB:n.RGBA,null===f&&(f=requestAnimationFrame(x))}));var x=function(){n.texImage2D(n.TEXTURE_2D,0,_,d,R,0,_,n.UNSIGNED_BYTE,s),n.drawArrays(n.TRIANGLES,0,6),f=null,s=null};r.events().onExit((function(){e.removeOnResize(h)}))}function initShaderProgram(e,r,t){var a=loadShader(e,e.VERTEX_SHADER,r),n=loadShader(e,e.FRAGMENT_SHADER,t),o=e.createProgram();if(e.attachShader(o,a),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+e.getProgramInfoLog(o));return o}function loadShader(e,r,t){var a=e.createShader(r);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){var n=e.getShaderInfoLog(a);throw e.deleteShader(a),new Error("An error occurred compiling the shaders: "+n)}return a}function initBuffers(e,r,t){var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),e.STATIC_DRAW),e.vertexAttribPointer(r,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),e.STATIC_DRAW),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t)}exports.webGl=webGl;