"use strict";exports.__esModule=!0,exports.audioNode=void 0;var SamplesQueue=function(){function e(){this.samplesQueue=[]}return e.prototype.push=function(e){this.samplesQueue.push(e)},e.prototype.length=function(){for(var e=0,t=0,n=this.samplesQueue;t<n.length;t++)e+=n[t].length;return e},e.prototype.writeTo=function(e,t){for(var n=0;this.samplesQueue.length>0;){var o=this.samplesQueue[0],u=Math.min(t-n,o.length);if(u===o.length?(e.set(o,n),this.samplesQueue.shift()):(e.set(o.slice(0,u),n),this.samplesQueue[0]=o.slice(u)),(n+=u)===t)break}n<t&&e.fill(0,n)},e}();function audioNode(e){var t=e.soundFrequency();if(0!==t){var n=null;if("undefined"!=typeof AudioContext?n=new AudioContext({sampleRate:t,latencyHint:"interactive"}):void 0!==window.webkitAudioContext&&(n=new window.webkitAudioContext({sampleRate:t,latencyHint:"interactive"})),null!=n){var o=new SamplesQueue;e.events().onSoundPush((function(e){o.length()<6144&&o.push(e)}));var u=n.createScriptProcessor(2048,0,1),i=!1;u.onaudioprocess=function(e){var t=e.outputBuffer.length,n=e.outputBuffer.numberOfChannels,u=o.length();if(i||(i=u>=2048),i)for(var s=0;s<n;s++){var r=e.outputBuffer.getChannelData(s);o.writeTo(r,t)}},u.connect(n.destination);var s=function(){null!==n&&"suspended"===n.state&&n.resume()};document.addEventListener("click",s,{once:!0}),document.addEventListener("touchstart",s,{once:!0}),document.addEventListener("keydown",s,{once:!0}),e.events().onExit((function(){null!==n&&(u.disconnect(),n.close()),document.removeEventListener("click",s),document.removeEventListener("touchstart",s),document.removeEventListener("keydown",s)}))}}else console.warn("Can't create audio node with sampleRate === 0, ingnoring")}exports.audioNode=audioNode;